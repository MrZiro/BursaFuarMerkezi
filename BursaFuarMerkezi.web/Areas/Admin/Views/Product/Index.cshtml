@model IEnumerable<Product>


<div class="container">
    <div class="row pt-4 pb-3">
        <div class="col-6">
            <h2 class="text-primary">
                Product List
            </h2>
        </div>
        <div class="col-6 text-end">
            <a asp-controller="Product" asp-action="Create" class="btn btn-primary">
                Create New Product
            </a>
        </div>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>
                        Product Name
                    </th>
                    <th>
                        Description
                    </th>
                   <th>
                        ISBN
                    </th>
                   <th>
                        Author
                    </th>
                     <th>
                        ListPrice
                    </th>
                     <th>
                        Price
                    </th>
                    <th>
                        Price50

                    </th>
                    <th>
                        Price100

                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.OrderBy(o => o.Id))
                {
                    <tr id="row-@item.Id">
                        <td>
                            @item.Title
                        </td>
                        <td>
                            @item.Description
                        </td>
                        <td>
                            @item.ISBN
                        </td>
                        <td>
                            @item.Author
                        </td>
                         <td>
                            @item.ListPrice
                        </td>
                         <td>
                            @item.Price
                        </td>
                        <td>
                            @item.Price50
                        <td>
                            @item.Price100
                        </td>


                        <td>
                            <div class="w-75 btn-group" role="group">
                                <a asp-controller="Product" asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary mx-2">
                                    <i class="bi bi-pencil-square"></i> Edit
                                </a>
                                @* <a asp-controller="Product" asp-action="Delete" class="btn btn-danger mx-2"> *@
                                @*     <i class="bi bi-trash-fill"></i> Delete *@
                                @* </a> *@
                                <button type="button"
                                        class="btn btn-danger"
                                        onclick="deleteProduct(@item.Id)">
                                    <i class="bi bi-trash-fill"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>
</div>


@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJ+YB+2n4zXaz2bJ9N6p0oK9ZXp5nEzafTNEI="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script>

        // toastr.info('Are you the 6 fingered man?')
        function deleteProduct(id) {
            if (!confirm("Are you sure you want to delete this Product?")) {
                return;
            }


            $.ajax({
                url: '@Url.Action("Delete")',
                type: 'POST',
                data: {
                    id: id
                },
                success: function (res) {
                    if (res.success) {
                        // Option A: remove the row in-place:
                        $('#row-'+id).fadeOut(300, function() { $(this).remove(); });
                        // Option B: or simply reload the page:
                        // location.reload();
                       // 2) build & show the Bootstrap alert
                        const alertHtml = `
                          <div class="alert alert-success alert-dismissible fade show" role="alert">
                            ${res.message}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                          </div>`;

                        // inject into the placeholder
                        // $('#alert-placeholder').html(alertHtml);

                        // optional: auto‐dismiss after 3 seconds
                        // setTimeout(() => {
                        //   $('.alert').alert('close');
                        // }, 2500);

                    } else {
                        alert("Delete failed: " + res.message);
                    }
                },
                error: function () {
                    alert("An error occurred while trying to delete.");
                }
            });
        }
    </script>
}